(ns co-who.composedb.composite)

#_(def abi-string "{\"models\":{\"BasicProfile\":{\"interface\":false,\"implements\":[],\"id\":\"kjzl6hvfrbw6c6mjgazqu3i9e03pqjberjbvdvxpzyjeaygmr0ivor0xynw1jl0\",\"accountRelation\":{\"type\":\"single\"}},\"Posts\":{\"interface\":false,\"implements\":[],\"id\":\"kjzl6hvfrbw6c7r36plp2vs62513mxirwfdqxcgi2intadooozep9aht83107kd\",\"accountRelation\":{\"type\":\"list\"}},\"Following\":{\"interface\":false,\"implements\":[],\"id\":\"kjzl6hvfrbw6c5a22508i3gdcpuk30joseuexdugxjk4n2cclfskiz0i71lynvu\",\"accountRelation\":{\"type\":\"list\"}},\"Comments\":{\"interface\":false,\"implements\":[],\"id\":\"kjzl6hvfrbw6c98zkv0375s91bj43td92gl4fc0ng5g2pkcjc84f3u55dqq2kee\",\"accountRelation\":{\"type\":\"list\"}}},\"objects\":{\"BasicProfile\":{\"name\":{\"type\":\"string\",\"required\":true},\"emoji\":{\"type\":\"string\",\"required\":false},\"gender\":{\"type\":\"string\",\"required\":false},\"username\":{\"type\":\"string\",\"required\":true},\"description\":{\"type\":\"string\",\"required\":false},\"author\":{\"type\":\"view\",\"viewType\":\"documentAccount\"},\"posts\":{\"type\":\"view\",\"viewType\":\"relation\",\"relation\":{\"source\":\"queryConnection\",\"model\":\"kjzl6hvfrbw6c7r36plp2vs62513mxirwfdqxcgi2intadooozep9aht83107kd\",\"property\":\"profileId\"}}},\"Posts\":{\"tag\":{\"type\":\"string\",\"required\":true,\"indexed\":true},\"body\":{\"type\":\"string\",\"required\":true},\"edited\":{\"type\":\"datetime\",\"required\":false,\"indexed\":true},\"created\":{\"type\":\"datetime\",\"required\":true,\"indexed\":true},\"profileId\":{\"type\":\"streamid\",\"required\":true},\"author\":{\"type\":\"view\",\"viewType\":\"documentAccount\"},\"profile\":{\"type\":\"view\",\"viewType\":\"relation\",\"relation\":{\"source\":\"document\",\"model\":\"kjzl6hvfrbw6c6mjgazqu3i9e03pqjberjbvdvxpzyjeaygmr0ivor0xynw1jl0\",\"property\":\"profileId\"}},\"responses\":{\"type\":\"view\",\"viewType\":\"relation\",\"relation\":{\"source\":\"queryConnection\",\"model\":\"kjzl6hvfrbw6c98zkv0375s91bj43td92gl4fc0ng5g2pkcjc84f3u55dqq2kee\",\"property\":\"postId\"}}},\"Following\":{\"profileId\":{\"type\":\"streamid\",\"required\":true},\"profile\":{\"type\":\"view\",\"viewType\":\"relation\",\"relation\":{\"source\":\"document\",\"model\":\"kjzl6hvfrbw6c6mjgazqu3i9e03pqjberjbvdvxpzyjeaygmr0ivor0xynw1jl0\",\"property\":\"profileId\"}}},\"Comments\":{\"edited\":{\"type\":\"datetime\",\"required\":false,\"indexed\":true},\"postId\":{\"type\":\"streamid\",\"required\":true},\"comment\":{\"type\":\"string\",\"required\":true},\"created\":{\"type\":\"datetime\",\"required\":true,\"indexed\":true},\"profileId\":{\"type\":\"streamid\",\"required\":true},\"post\":{\"type\":\"view\",\"viewType\":\"relation\",\"relation\":{\"source\":\"document\",\"model\":\"kjzl6hvfrbw6c7r36plp2vs62513mxirwfdqxcgi2intadooozep9aht83107kd\",\"property\":\"postId\"}},\"profile\":{\"type\":\"view\",\"viewType\":\"relation\",\"relation\":{\"source\":\"document\",\"model\":\"kjzl6hvfrbw6c6mjgazqu3i9e03pqjberjbvdvxpzyjeaygmr0ivor0xynw1jl0\",\"property\":\"profileId\"}}}},\"enums\":{},\"accountData\":{\"basicProfile\":{\"type\":\"node\",\"name\":\"BasicProfile\"},\"postsList\":{\"type\":\"connection\",\"name\":\"Posts\"},\"followingList\":{\"type\":\"connection\",\"name\":\"Following\"},\"commentsList\":{\"type\":\"connection\",\"name\":\"Comments\"}}}")

#_(def abi-string "{\"version\":\"1.1\",\"models\":{\"kjzl6hvfrbw6cbadjdrmlugjpyi53vx9443m06hc1qo25mktbhz2ilo6t2wcyxu\":[{\"jws\":{\"payload\":\"AXESIMlWaP5AgZ5npGxSp4KC9qHEOm8CUC0zGIAw8B5Sm1SC\",\"signatures\":[{\"signature\":\"YOwRuV5UNx-un4_BgCi5cD8_3dMhy-B4lziETE6duZX3RxBMkfcjXbFfFcBuqcqGktYwqLTzTcrnabAp7FFTCw\",\"protected\":\"eyJhbGciOiJFZERTQSIsImtpZCI6ImRpZDprZXk6ejZNa2tyRVh2Zms0bjhQUDJYazlNTTQ1eXZnWnVtVTUyQ2h1S1NtV0V3NUFnV2tEI3o2TWtrckVYdmZrNG44UFAyWGs5TU00NXl2Z1p1bVU1MkNodUtTbVdFdzVBZ1drRCJ9\"}],\"link\":\"bafyreigjkzup4qebtzt2i3csu6bif5vbyq5g6asqfuzrrabq6apffg2uqi\"},\"linkedBlock\":\"omRkYXRhqmRuYW1laENhdGVnb3J5ZXZpZXdzoGZzY2hlbWGlZHR5cGVmb2JqZWN0ZSRkZWZzoWpHcmFwaFFMRElEpGR0eXBlZnN0cmluZ2V0aXRsZWpHcmFwaFFMRElEZ3BhdHRlcm54j15kaWQ6W2EtekEtWjAtOS4hIyQlJicqK1wvPT9eX2B7fH1+LV0rOlthLXpBLVowLTkuISMkJSYnKitcLz0/Xl9ge3x9fi1dKjo/W2EtekEtWjAtOS4hIyQlJicqK1wvPT9eX2B7fH1+LV0qOj9bYS16QS1aMC05LiEjJCUmJyorXC89P15fYHt8fX4tXSokaW1heExlbmd0aBhkZyRzY2hlbWF4LGh0dHBzOi8vanNvbi1zY2hlbWEub3JnL2RyYWZ0LzIwMjAtMTIvc2NoZW1hanByb3BlcnRpZXOhbG1haW5SZXZpZXdlcqFkJHJlZnIjLyRkZWZzL0dyYXBoUUxESUR0YWRkaXRpb25hbFByb3BlcnRpZXP0Z3ZlcnNpb25jMi4waWludGVyZmFjZfRpcmVsYXRpb25zoWxtYWluUmV2aWV3ZXKhZHR5cGVnYWNjb3VudGppbXBsZW1lbnRzgGtkZXNjcmlwdGlvbnhAQSBjYXRlZ29yeSB0byBncm91cCBvdGhlciBjYXRlZ29yaWVzIGFuZC9vciByZXF1aXJlbWVudHMsIHRhc2tzLm9hY2NvdW50UmVsYXRpb26hZHR5cGVkbGlzdG9pbW11dGFibGVGaWVsZHOAZmhlYWRlcqNjc2VwZW1vZGVsZW1vZGVsUs4BBAFxcQsACWhtb2RlbC12MWtjb250cm9sbGVyc4F4OGRpZDprZXk6ejZNa2tyRVh2Zms0bjhQUDJYazlNTTQ1eXZnWnVtVTUyQ2h1S1NtV0V3NUFnV2tE\"}],\"kjzl6hvfrbw6c6qdm1984obrxyzwm81nl3aqe460zpubhdnpniuz5vcmaexj9t2\":[{\"jws\":{\"payload\":\"AXESILKjgXxiy4MYY-xdWRVGb6HicX9_r26okHuGG8ATuzGb\",\"signatures\":[{\"signature\":\"Gr9DbMZ9wR9GOza2C0RrhzcvyPLigfhvO4PHt5QCUlMzMV5fDGkj8amsHDoJm8U0MXh0yPlAzZREzzHkhQAGBQ\",\"protected\":\"eyJhbGciOiJFZERTQSIsImtpZCI6ImRpZDprZXk6ejZNa2tyRVh2Zms0bjhQUDJYazlNTTQ1eXZnWnVtVTUyQ2h1S1NtV0V3NUFnV2tEI3o2TWtrckVYdmZrNG44UFAyWGs5TU00NXl2Z1p1bVU1MkNodUtTbVdFdzVBZ1drRCJ9\"}],\"link\":\"bafyreifsuoaxyywlqmmgh3c5lekum35b4jyx675pn2uja64gdpabhozrtm\"},\"linkedBlock\":\"omRkYXRhqmRuYW1lZFVzZXJldmlld3OhZmF1dGhvcqFkdHlwZW9kb2N1bWVudEFjY291bnRmc2NoZW1hpWR0eXBlZm9iamVjdGckc2NoZW1heCxodHRwczovL2pzb24tc2NoZW1hLm9yZy9kcmFmdC8yMDIwLTEyL3NjaGVtYWhyZXF1aXJlZIJpZmlyc3ROYW1laGxhc3ROYW1lanByb3BlcnRpZXOjaGxhc3ROYW1lo2R0eXBlZnN0cmluZ2ltYXhMZW5ndGgYZGltaW5MZW5ndGgDaWZpcnN0TmFtZaNkdHlwZWZzdHJpbmdpbWF4TGVuZ3RoGGRpbWluTGVuZ3RoA2xpbnRyb2R1Y3Rpb26jZHR5cGVmc3RyaW5naW1heExlbmd0aBkCWGltaW5MZW5ndGgAdGFkZGl0aW9uYWxQcm9wZXJ0aWVz9Gd2ZXJzaW9uYzIuMGlpbnRlcmZhY2X0aXJlbGF0aW9uc6BqaW1wbGVtZW50c4BrZGVzY3JpcHRpb254QEEgY2F0ZWdvcnkgdG8gZ3JvdXAgb3RoZXIgY2F0ZWdvcmllcyBhbmQvb3IgcmVxdWlyZW1lbnRzLCB0YXNrcy5vYWNjb3VudFJlbGF0aW9uoWR0eXBlZnNpbmdsZW9pbW11dGFibGVGaWVsZHOAZmhlYWRlcqNjc2VwZW1vZGVsZW1vZGVsUs4BBAFxcQsACWhtb2RlbC12MWtjb250cm9sbGVyc4F4OGRpZDprZXk6ejZNa2tyRVh2Zms0bjhQUDJYazlNTTQ1eXZnWnVtVTUyQ2h1S1NtV0V3NUFnV2tE\"}]},\"indices\":{\"kjzl6hvfrbw6cbadjdrmlugjpyi53vx9443m06hc1qo25mktbhz2ilo6t2wcyxu\":[],\"kjzl6hvfrbw6c6qdm1984obrxyzwm81nl3aqe460zpubhdnpniuz5vcmaexj9t2\":[]},\"aliases\":{\"kjzl6hvfrbw6cbadjdrmlugjpyi53vx9443m06hc1qo25mktbhz2ilo6t2wcyxu\":\"Category\",\"kjzl6hvfrbw6c6qdm1984obrxyzwm81nl3aqe460zpubhdnpniuz5vcmaexj9t2\":\"User\"},\"views\":{\"account\":{},\"root\":{},\"models\":{\"kjzl6hvfrbw6cbadjdrmlugjpyi53vx9443m06hc1qo25mktbhz2ilo6t2wcyxu\":{\"categories\":{\"type\":\"relationFrom\",\"model\":\"kjzl6hvfrbw6cbadjdrmlugjpyi53vx9443m06hc1qo25mktbhz2ilo6t2wcyxu\",\"property\":\"parentID\"}},\"kjzl6hvfrbw6c6qdm1984obrxyzwm81nl3aqe460zpubhdnpniuz5vcmaexj9t2\":{}}},\"commonEmbeds\":[]}")

(def composite (atom nil))

(defn ^:async fetch-abi []
  (let [res (js-await (js/fetch "./__generated__/definition.json"))
        data (js-await ((aget res "json")))]
    (reset! composite data)
    data))


#_(.then (fetch-abi) (fn [data] (reset! composite data)))
